<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Simulador de Avance</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 font-sans p-4">
<h1 class="text-2xl mb-4">Simulador de Avance</h1>
<div id="legend" class="flex gap-4 mb-4 text-sm">
  <div class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-gray-600 inline-block"></span><span>No cursada</span></div>
  <div class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-yellow-600 inline-block"></span><span>Regular</span></div>
  <div class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-green-700 inline-block"></span><span>Aprobada</span></div>
</div>
<div id="controls" class="flex flex-wrap gap-2 mb-4">
  <select id="plan" class="bg-gray-800 border border-gray-600 rounded p-2"></select>
  <button id="save" class="bg-blue-700 hover:bg-blue-600 active:bg-blue-800 px-3 py-2 rounded">Guardar</button>
  <button id="reset" class="bg-red-700 hover:bg-red-600 active:bg-red-800 px-3 py-2 rounded">Reiniciar</button>
  <button id="export" class="bg-gray-700 hover:bg-gray-600 active:bg-gray-800 px-3 py-2 rounded">Exportar JSON</button>
  <button id="import" class="bg-gray-700 hover:bg-gray-600 active:bg-gray-800 px-3 py-2 rounded">Importar JSON</button>
  <input type="file" id="fileInput" class="hidden" />
</div>
<div id="stats" class="mb-4"></div>
<div id="materias" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
<script>
const STORAGE_KEY='simulador-avance';
let plans={},currentPlan='2023',states={};
fetch('plans.json').then(r=>r.json()).then(data=>{
  plans=data;
  const sel=document.getElementById('plan');
  Object.entries(plans).forEach(([key,plan])=>{
    const opt=document.createElement('option');
    opt.value=key;opt.textContent=plan.nombre;sel.appendChild(opt);
  });
  sel.addEventListener('change',()=>{currentPlan=sel.value;loadStates();render();});
  loadStates();render();
});
function loadStates(){
  const all=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
  states=all[currentPlan]||{};
}
function saveStates(){
  const all=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
  all[currentPlan]=states;
  localStorage.setItem(STORAGE_KEY,JSON.stringify(all));
}
function resetStates(){
  states={};
  saveStates();
  render();
}
function toggleState(code){
  const s=states[code]||0;
  states[code]=(s+1)%3;
  saveStates();
  render();
}
function allowed(code){
  const mat=plans[currentPlan].materias.find(m=>m.codigo===code);
  return mat.correlativas.every(c=>(states[c]||0)==2);
}
function render(){
  const container=document.getElementById('materias');
  container.innerHTML='';
  const stateClasses=['bg-gray-700','bg-yellow-600','bg-green-700'];
  plans[currentPlan].materias.forEach(m=>{
    const card=document.createElement('div');
    const state=states[m.codigo]||0;
    card.className=`p-4 rounded-lg border border-gray-600 transition transform hover:scale-105 hover:shadow-lg active:scale-95 cursor-pointer ${stateClasses[state]}`;
    if(!allowed(m.codigo))card.classList.add('opacity-40','cursor-not-allowed');
    card.innerHTML=`<strong class="block mb-1">${m.codigo} ‚Äî ${m.nombre}</strong>`+
      `<div class="flex flex-wrap gap-2 text-xs">
        <span class="inline-flex items-center gap-1 bg-gray-800 px-2 py-0.5 rounded">A√±o: ${m.anio}</span>
        <span class="inline-flex items-center gap-1 bg-gray-800 px-2 py-0.5 rounded">Cuatr: ${m.cuatrimestre}</span>
        <span class="inline-flex items-center gap-1 bg-gray-800 px-2 py-0.5 rounded"><span>üìÖ</span>${m.regimen}</span>
        <span class="inline-flex items-center gap-1 bg-gray-800 px-2 py-0.5 rounded"><span>‚è±Ô∏è</span>${m.carga_horaria}h</span>
      </div>`+
      (m.correlativas.length?`<div class="text-xs mt-2 flex items-center gap-1"><span>üîó</span>${m.correlativas.join(', ')}</div>`:'');
    if(allowed(m.codigo))card.addEventListener('click',()=>toggleState(m.codigo));
    container.appendChild(card);
  });
  updateStats();
}
function updateStats(){
  const counts={0:0,1:0,2:0};
  plans[currentPlan].materias.forEach(m=>{counts[states[m.codigo]||0]++;});
  document.getElementById('stats').textContent=`Aprobadas: ${counts[2]} | Regulares: ${counts[1]} | No cursadas: ${counts[0]} | Total: ${plans[currentPlan].materias.length}`;
}
document.getElementById('save').addEventListener('click',saveStates);
document.getElementById('reset').addEventListener('click',resetStates);
document.getElementById('export').addEventListener('click',()=>{
  const data=localStorage.getItem(STORAGE_KEY)||'{}';
  const blob=new Blob([data],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='simulador.json';
  a.click();
});
document.getElementById('import').addEventListener('click',()=>document.getElementById('fileInput').click());
document.getElementById('fileInput').addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    try{
      localStorage.setItem(STORAGE_KEY,ev.target.result);
      loadStates();
      render();
    }catch(err){alert('JSON inv√°lido');}
  };
  reader.readAsText(file);
});
</script>
</body>
</html>
