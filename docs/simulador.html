<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Simulador de Avance</title>

<style>
body{font-family:Arial,Helvetica,sans-serif;background:#121212;color:#eee;margin:0;padding:1rem;}
#controls{margin-bottom:1rem;}
#materias{display:flex;flex-wrap:wrap;gap:0.5rem;}
.card{border:1px solid #444;border-radius:8px;padding:0.5rem;background:#333;flex:1 1 300px;cursor:pointer;}
.card.no{background:#444;}
.card.regular{background:#b59f3b;}
.card.aprobada{background:#2e7d32;}
.card.disabled{opacity:0.4;cursor:not-allowed;}
.badges span{margin-right:0.3rem;background:#555;padding:0.1rem 0.3rem;border-radius:4px;font-size:0.8rem;}
@media(max-width:600px){.card{flex:1 1 100%;}}
footer{background:#121212;color:#eee;text-align:center;padding:1rem;margin-top:1rem;}
footer a{color:#b59f3b;text-decoration:none;}
@media(min-width:600px){footer{position:fixed;bottom:0;left:0;width:100%;}}
</style>

</head>
<body class="bg-gray-900 text-gray-100 font-sans p-4">
<h1 class="text-2xl mb-4">Simulador de Avance</h1>
<div id="legend" class="flex gap-4 mb-4 text-sm">
  <div class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-gray-600 inline-block"></span><span>No cursada</span></div>
  <div class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-yellow-600 inline-block"></span><span>Regular</span></div>
  <div class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-green-700 inline-block"></span><span>Aprobada</span></div>
</div>

<div id="stats"></div>
<div id="materias"></div>
<footer>Hecho por <a href="https://github.com/openai" target="_blank">ChatGPT</a></footer>

<script>
const STORAGE_KEY='simulador-avance';
let plans={},currentPlan='2023',states={};
fetch('plans.json').then(r=>r.json()).then(data=>{
  plans=data;
  const sel=document.getElementById('plan');
  Object.entries(plans).forEach(([key,plan])=>{
    const opt=document.createElement('option');
    opt.value=key;opt.textContent=plan.nombre;sel.appendChild(opt);
  });
  sel.addEventListener('change',()=>{currentPlan=sel.value;loadStates();render();});
  loadStates();render();
});
function loadStates(){
  const all=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
  states=all[currentPlan]||{};
}
function saveStates(){
  const all=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
  all[currentPlan]=states;
  localStorage.setItem(STORAGE_KEY,JSON.stringify(all));
}
function resetStates(){
  states={};
  saveStates();
  render();
}
function toggleState(code){
  const s=states[code]||0;
  states[code]=(s+1)%3;
  saveStates();
  render();
}
function allowed(code){
  const mat=plans[currentPlan].materias.find(m=>m.codigo===code);
  return mat.correlativas.every(c=>(states[c]||0)==2);
}
function render(){
  const container=document.getElementById('materias');
  container.innerHTML='';
  const stateClasses=['bg-gray-700','bg-yellow-600','bg-green-700'];
  plans[currentPlan].materias.forEach(m=>{
    const card=document.createElement('div');
    const state=states[m.codigo]||0;
    card.className=`p-4 rounded-lg border border-gray-600 transition transform hover:scale-105 hover:shadow-lg active:scale-95 cursor-pointer ${stateClasses[state]}`;
    if(!allowed(m.codigo))card.classList.add('opacity-40','cursor-not-allowed');
    card.innerHTML=`<strong class="block mb-1">${m.codigo} ‚Äî ${m.nombre}</strong>`+
      `<div class="flex flex-wrap gap-2 text-xs">
        <span class="inline-flex items-center gap-1 bg-gray-800 px-2 py-0.5 rounded">A√±o: ${m.anio}</span>
        <span class="inline-flex items-center gap-1 bg-gray-800 px-2 py-0.5 rounded">Cuatr: ${m.cuatrimestre}</span>
        <span class="inline-flex items-center gap-1 bg-gray-800 px-2 py-0.5 rounded"><span>üìÖ</span>${m.regimen}</span>
        <span class="inline-flex items-center gap-1 bg-gray-800 px-2 py-0.5 rounded"><span>‚è±Ô∏è</span>${m.carga_horaria}h</span>
      </div>`+
      (m.correlativas.length?`<div class="text-xs mt-2 flex items-center gap-1"><span>üîó</span>${m.correlativas.join(', ')}</div>`:'');
    if(allowed(m.codigo))card.addEventListener('click',()=>toggleState(m.codigo));
    container.appendChild(card);
  });
  updateStats();
}
function updateStats(){
  const counts={0:0,1:0,2:0};
  plans[currentPlan].materias.forEach(m=>{counts[states[m.codigo]||0]++;});
  document.getElementById('stats').textContent=`Aprobadas: ${counts[2]} | Regulares: ${counts[1]} | No cursadas: ${counts[0]} | Total: ${plans[currentPlan].materias.length}`;
}
document.getElementById('save').addEventListener('click',saveStates);
document.getElementById('reset').addEventListener('click',resetStates);
document.getElementById('export').addEventListener('click',()=>{
  const data=localStorage.getItem(STORAGE_KEY)||'{}';
  const blob=new Blob([data],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='simulador.json';
  a.click();
});
document.getElementById('import').addEventListener('click',()=>document.getElementById('fileInput').click());
document.getElementById('fileInput').addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    try{
      localStorage.setItem(STORAGE_KEY,ev.target.result);
      loadStates();
      render();
    }catch(err){alert('JSON inv√°lido');}
  };
  reader.readAsText(file);
});
</script>
</body>
</html>
